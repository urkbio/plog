# Plog 数据备份功能使用说明

## 功能概述

Plog 提供了完整的数据备份和恢复功能，支持导出和导入所有博客数据，包括：
- 文章标题、内容、创建时间、更新时间
- 标签信息
- 独立页面设置
- 文章与标签的关联关系

## 备份文件位置

所有备份文件默认保存在项目根目录的 `backups/` 文件夹中：
```
plog/
├── backups/                    # 备份文件目录
│   ├── plog_backup_20250720_180441.json
│   └── plog_backup_20250720_175506.json
├── app.py
├── backup.py
└── ...
```

## 备份方式

### 1. 网页界面备份（推荐）

#### 导出数据
1. 登录管理后台：`http://localhost:5001/plog-admin`
2. 点击左侧菜单的"导出数据"
3. 系统会自动下载一个 JSON 格式的备份文件
4. 文件名格式：`plog_backup_YYYYMMDD_HHMMSS.json`
5. 文件会自动保存到 `backups/` 文件夹

#### 导入数据
1. 登录管理后台：`http://localhost:5001/plog-admin`
2. 点击左侧菜单的"导入数据"
3. 选择之前导出的 JSON 备份文件
4. 点击"开始导入"
5. 系统会自动处理重复数据，跳过已存在的文章和标签

### 2. 命令行备份

#### 导出数据
```bash
# 激活虚拟环境
source venv/bin/activate

# 导出数据（自动生成文件名，保存到backups/）
python backup.py export

# 导出数据（指定文件名，保存到backups/）
python backup.py export my_backup.json
```

#### 导入数据
```bash
# 激活虚拟环境
source venv/bin/activate

# 导入数据（从backups/文件夹查找）
python backup.py import plog_backup_20250720_180441.json

# 导入数据（指定完整路径）
python backup.py import /path/to/backup.json

# 强制导入（跳过确认）
python backup.py import plog_backup_20250720_180441.json --force
```

## 备份文件格式

备份文件采用 JSON 格式，结构如下：

```json
{
  "version": "1.0",
  "exported_at": "2025-07-20T18:04:41.123456",
  "posts": [
    {
      "id": 1,
      "title": "文章标题",
      "content": "文章内容（Markdown格式）",
      "created_at": "2025-07-20T17:47:56.174096",
      "updated_at": "2025-07-20T17:47:56.174102",
      "is_page": false,
      "slug": "文章URL标识",
      "tags": ["标签1", "标签2"]
    }
  ],
  "tags": [
    {
      "id": 1,
      "name": "标签名称"
    }
  ]
}
```

## 安全特性

### 导入保护机制
- **重复检测**：基于文章 slug 检测重复，自动跳过已存在的文章
- **标签去重**：自动检测重复标签，不会重复创建
- **事务保护**：导入过程中如果出错，会自动回滚，不会破坏现有数据
- **数据验证**：验证备份文件格式，确保数据完整性
- **智能路径**：导入时自动在 `backups/` 文件夹中查找文件

### 建议的备份策略
1. **定期备份**：建议每周或每月进行一次完整备份
2. **多重备份**：将 `backups/` 文件夹同步到云盘或其他安全位置
3. **版本管理**：保留多个版本的备份文件
4. **测试恢复**：定期测试备份文件的恢复功能

## 文件管理

### 备份文件命名规则
- 格式：`plog_backup_YYYYMMDD_HHMMSS.json`
- 示例：`plog_backup_20250720_180441.json`

### 自动创建目录
- 系统会自动创建 `backups/` 文件夹
- 如果文件夹不存在，会在导出时自动创建

### 版本控制
- `backups/` 文件夹已添加到 `.gitignore`
- 备份文件不会被提交到版本控制系统
- 保护敏感数据不被意外提交

## 常见问题

### Q: 备份文件很大怎么办？
A: 备份文件是纯文本格式，可以使用压缩软件压缩后存储。

### Q: 可以只备份部分数据吗？
A: 目前支持完整备份，如果需要部分备份，可以手动编辑 JSON 文件。

### Q: 导入时出现错误怎么办？
A: 检查备份文件是否完整，确保是有效的 JSON 格式。如果仍有问题，可以查看错误日志。

### Q: 可以跨版本导入吗？
A: 支持跨版本导入，系统会自动处理数据格式差异。

### Q: 如何找到备份文件？
A: 所有备份文件都保存在项目根目录的 `backups/` 文件夹中。

## 注意事项

1. **备份前确认**：确保当前数据是最新状态
2. **导入前备份**：导入前建议先备份当前数据
3. **文件权限**：确保 `backups/` 文件夹有读写权限
4. **磁盘空间**：确保有足够的磁盘空间存储备份文件
5. **网络环境**：网页备份需要稳定的网络连接
6. **路径安全**：备份文件路径已添加到 `.gitignore`，不会被意外提交

## 技术支持

如果遇到问题，可以：
1. 查看错误日志
2. 检查备份文件格式
3. 确认数据库连接正常
4. 检查 `backups/` 文件夹权限
5. 联系技术支持 